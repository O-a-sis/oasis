<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">

	
<!-- 관리자 지점 관리 리스트 -->
<select id="storeList" resultType="hashmap">
        <![CDATA[
        SELECT
                R.*,S.*
        FROM
                S_MEMBER S, REVENUE R
        WHERE
                S.STORE = R.R_IDX(+)
        Order by S.STORE DESC             
        ]]>
</select>

<!-- 관리자 지점 관리 (+ 매출순위) 리스트 -->
<select id="storeListRank" resultType="hashmap">
        <![CDATA[
        SELECT
                R.*,S.*
        FROM
                S_MEMBER S, REVENUE R
        WHERE
                S.STORE = R.R_IDX(+)
        Order by R.R_SUM DESC             
        ]]>
</select>



<!-- 관리자 지점 상세보기 -->
<select id="storeDetail" parameterType="hashmap" resultType="hashmap">
 <![CDATA[
     SELECT S.*, R.*
     FROM 
      S_MEMBER S, REVENUE R
                        WHERE
                S.STORE = R.R_IDX and R.R_IDX = #{R_IDX}
   ]]>
</select>


<!-- 관리자 지점 추가하기(회원가입) -->
<insert id="storeJoin" parameterType="hashmap" useGeneratedKeys="true" keyProperty="STORE">
        <![CDATA[
                INSERT INTO 
                        S_MEMBER(
                                STORE, S_PASSWORD, S_NAME, S_MANAGER, ADDRESS1, ADDRESS2,
                                POSTCODE, S_PHONE, S_DATE, S_STATUS, DEL_GB
                                )
                        VALUES (
                                #{STORE}, 
                                #{S_PASSWORD}, 
                                #{S_NAME},
                                #{S_MANAGER}, 
                                #{ADDRESS1}, 
                                #{ADDRESS2},
                                #{POSTCODE},
                                #{S_PHONE},
                                SYSDATE, 
                                0,
                                'N')
 ]]>
</insert>

<!-- 관리자 지점 수정기능 -->
<update id="openStoreUpdate" parameterType="hashmap">
        <![CDATA[
                UPDATE 
                        S_MEMBER
                SET 
                        S_MANAGER = #{S_MANAGER}, 
                        ADDRESS1 = #{ADDRESS1},
                        ADDRESS2 = #{ADDRESS2},
                        POSTCODE = #{POSTCODE},
                        S_PHONE = #{S_PHONE}
                WHERE 
                        S_NAME=#{S_NAME}
                ]]>
</update>



<!-- 관리자 지점 폐쇄기능 -->
<update id="storeDown" parameterType="hashmap">
        <![CDATA[
                UPDATE S_MEMBER
                SET
                        DEL_GB = 'Y'
                WHERE
                        STORE = #{STORE}
                        ]]>
</update>


<!-- 공지사항 리스트 -->
        <select id="noticeList" parameterType="hashmap"
                resultType="hashmap">
                <include refid="common.pagingPre" /> 
                <![CDATA[
              SELECT ROW_NUMBER() OVER(ORDER BY N_DATE DESC) RNUM,
                     N_IDX, N_TITLE, N_CONTENT, N_DATE, N_IMAGE, N_TYPE 
              FROM
                            NOTICE
                        ]]>
                <include refid="noticeSearch" />
                <include refid="common.pagingPost" />
        </select>

        <!-- 공지사항 상세보기 -->
        <select id="noticeDetail" parameterType="hashmap"
                resultType="hashmap">
        <![CDATA[
                SELECT N_IDX, N_TITLE, N_CONTENT, N_DATE, N_IMAGE,N_TYPE FROM NOTICE WHERE N_IDX =#{N_IDX}
        ]]>
        </select>

        <!-- 공지사항 입력 -->
        <insert id="noticeWrite" parameterType="hashmap"
                useGeneratedKeys="true" keyProperty="N_IDX">
                <selectKey keyProperty="N_IDX" resultType="string"
                        order="BEFORE">
                        SELECT N_IDX_SEQ.NEXTVAL FROM DUAL
                </selectKey>
                <![CDATA[
                INSERT INTO NOTICE(
                       N_IDX,
                       N_TITLE,
                           N_CONTENT,
                           N_DATE,
                           N_IMAGE,
                           N_TYPE
                )VALUES(
                                #{N_IDX}, 
                                #{N_TITLE},
                                #{N_CONTENT}, 
                                SYSDATE,  
                                #{N_IMAGE}, 
                                #{N_TYPE}
                )
                ]]>
        </insert>

    <!-- 공지사항 수정 -->
        <update id="noticeUpdate" parameterType="hashmap">
                <![CDATA[
                UPDATE 
                          NOTICE 
                SET
                          N_TITLE=#{N_TITLE},                                
                          N_CONTENT=#{N_CONTENT},
                          N_IMAGE=#{N_IMAGE}
                          N_DATE=SYSDATE
                WHERE
                          N_IDX=#{N_IDX}        
                ]]>
        </update>

        <!-- 공지사항 삭제 -->
        <delete id="noticeDelete" parameterType="hashmap">
                <![CDATA[
                  DELETE FROM NOTICE WHERE N_IDX = #{N_IDX}        
                ]]>
        </delete>


</mapper>