<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

<!-- 공지사항 검색 -->
	<sql id="noticeSearch">
		<trim prefix=" AND ( " suffix=" ) " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="or">
					<choose>
						<when test="type=='T'.toString()">
							N_TITLE like '%'||#{keyword}||'%'
						</when>
						<when test="type=='C'.toString()">
							N_CONTENT like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

		<!-- insertMember(회원가입) -->
	<insert id="insertMember" parameterType="hashmap">
<![CDATA[
INSERT INTO 
		B_MEMBER 
		(B_PHONE, B_PASSWORD, B_NAME, B_BIRTH, B_NICKNAME, B_DATE, STAMP)
	VALUES
		( #{B_PHONE},
		#{B_PASSWORD},
		#{B_NAME},
		#{B_BIRTH},
		#{B_NICKNAME},
		SYSDATE,
		0)
]]>
	</insert>

	<!-- 로그인 -->
<select id="getMember" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT *
	FROM 
		B_MEMBER
	WHERE
		B_PHONE=#{B_PHONE}
]]>
	</select>

<!-- findPassword(비밀번호 찾기) -->
	<select id="findPassword" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT *
	FROM 
		B_MEMBER
	WHERE 
		B_PHONE=#{B_PHONE} AND B_NAME=#{B_NAME}
]]>
	</select>

		<!-- 메뉴바 -->
<select id="myMenuBar" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT *
   FROM 
      B_MEMBER
   WHERE
     B_PHONE=#{B_PHONE}
]]>
	</select>

	<!-- 쿠폰 목록 -->
<select id="myCouponList" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT *
	FROM 
		COUPON
	WHERE 
		CUB_IDX=#{CUB_IDX}
]]>
	</select>


<select id="useCoupon" parameterType="hashmap"
	resultType="hashmap">
	<![CDATA[
	SELECT CU_PRICE
		FROM COUPON
			WHERE CU_IDX=#{CU_IDX}
	]]>
	
	</select>
	
	
	<!-- 주문 내역 -->
<select id="myOrderList" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT *
   FROM 
      ORDERS
   WHERE
      OB_IDX=#{OB_IDX}
]]>
	</select>


	<!-- 주문내역 상세 -->
<select id="myOrderDetail" parameterType="hashmap"
		resultType="hashmap">
<![CDATA[
SELECT * 
	FROM 
		ORDERS
	WHERE
		O_IDX=#{O_IDX}
]]>
	</select>

	<!-- 이미지???????  -->
<select id="selectImageList" parameterType="hashmap"
		resultType="hashmap">
	<![CDATA[
	 SELECT 
         P_IMG
   FROM 
        PRODUCT
   WHERE
         
	]]>
	</select>
	
	
	<!-- 내 스탬프  -->
	<select id="myStamp" parameterType="hashmap"
		resultType="hashmap">
	<![CDATA[
	 SELECT 
         *
   FROM 
        B_MEMBER
   WHERE
         B_PHONE=#{B_PHONE}
	]]>
	</select>
	
	    <!-- 공지사항 리스트 -->
	<select id="noticeList" parameterType="hashmap"
		resultType="hashmap">
		<include refid="common.pagingPre" /> 
		<![CDATA[
	      SELECT ROW_NUMBER() OVER(ORDER BY N_DATE DESC) RNUM,
	             N_IDX, N_TITLE, N_CONTENT, N_DATE, N_IMAGE, N_TYPE 
	      FROM
   		         NOTICE
   		  WHERE
   		  		NOT N_TYPE = 'S' 
			]]>
		<include refid="noticeSearch"></include>
		<include refid="common.pagingPost" />
	</select>

	<!-- 공지사항 디테일 -->
	<select id="noticeDetail" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
		SELECT 
				N_IDX, N_TITLE, N_CONTENT, N_DATE, N_IMAGE,N_TYPE 
		FROM 
				NOTICE 
		WHERE 
				N_IDX =#{N_IDX}
		]]>
		</select>

<!-- 매장리스트 -->
	<select id="getStoreList" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
		SELECT * FROM 
		S_MEMBER
		]]>
	</select>
<!-- 매장디테일 -->
	<select id="storeDetail" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
			SELECT
				*
			FROM
				S_MEMBER
			WHERE
				STORE = #{STORE}		
		]]>
	</select>
</mapper>